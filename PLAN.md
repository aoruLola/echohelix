# é˜¶æ®µæ‰§è¡Œæ–¹æ¡ˆ (PLAN)

> **å½“å‰èšç„¦**: Phase 3 (ç¨³å®šåŒ–) & Phase 6 (ä½“éªŒä¼˜åŒ–)
> **å±‚çº§å®šä½**: æŠ€æœ¯æ–¹æ¡ˆ (Design) -> å…·ä½“å®ç°ç±» (Spec)ã€‚

## ğŸ¯ ç›®æ ‡æ‘˜è¦

æœ¬è®¡åˆ’æ—¨åœ¨è½å®è·¯çº¿å›¾ä¸­ Phase 3 å’Œ Phase 6 çš„å…·ä½“æŠ€æœ¯è®¾è®¡ã€‚
1.  **Phase 3**: ç¡®ä¿åç«¯ Bridge æœåŠ¡ç¨³å®šç¼–è¯‘ã€è¿è¡Œï¼Œä¾èµ–æ— è¯¯ã€‚
2.  **Phase 6**: ä¸ºå‰ç«¯å¼•å…¥ç¬¦å·åŒ–è¾“å…¥é€»è¾‘ (`@`/`/`) å’Œå®‰å…¨æ§åˆ¶ã€‚

## ğŸ› ï¸ æŠ€æœ¯è®¾è®¡ (Technical Spec)

### 1. Phase 3: Backend Stabilization (ä¼˜å…ˆçº§: Critical)

ç›®æ ‡ï¼šæ¶ˆé™¤æ‰€æœ‰ç¼–è¯‘é”™è¯¯ï¼Œç¡®ä¿ Bridge æˆä¸ºå¯é çš„ "Dumb Pipe"ã€‚

- **[FIX] ä¾èµ–ç®¡ç† (`go.mod`)**:
    - é—®é¢˜: ç¼ºå¤± `zerolog` ç­‰ç¬¬ä¸‰æ–¹åº“ã€‚
    - æ–¹æ¡ˆ: è¿è¡Œ `go mod tidy` å¹¶æäº¤æ›´æ–°åçš„ `go.sum`ã€‚
- **[FIX] è¯­æ³•ä¿®å¤ (`manager.go`)**:
    - é—®é¢˜: é”™è¯¯çš„ `java.io.Reader` å¼•ç”¨ã€‚
    - æ–¹æ¡ˆ: æ›¿æ¢ä¸º `io.Reader`ï¼Œä½¿ç”¨ `bufio.Scanner` å®ç°æ—¥å¿—æµè¯»å–ã€‚
- **[NEW] è¿›ç¨‹ç®¡ç†å¢å¼º**:
    - æ–¹æ¡ˆ: ç¡®ä¿ `ProcessManager` æ­£ç¡®å¤„ç† Windows ä¸‹çš„å­è¿›ç¨‹é€€å‡ºé—®é¢˜ (ä½¿ç”¨ `taskkill /F /T`)ã€‚

### 2. Phase 6: Experience Polish (ä¼˜å…ˆçº§: High)

ç›®æ ‡ï¼šæ¨¡ä»¿ Vicoaï¼Œæå‡ç§»åŠ¨ç«¯è¾“å…¥æ•ˆç‡ã€‚

#### 2.1 Feature A: æ™ºèƒ½è¾“å…¥ (`@` & `/`)
- **å‰ç«¯æ¶æ„ (Flutter)**:
    - ç»„ä»¶: `SmartInputController` ç»§æ‰¿ `TextEditingController`ã€‚
    - é€»è¾‘: ç›‘å¬è¾“å…¥å˜åŒ–ï¼Œæ£€æµ‹è§¦å‘ç¬¦ (`@` æˆ– `/`)ã€‚
    - æ•°æ®æº:
        - `@`: è°ƒç”¨ Bridge `fs.ls` æ¥å£è·å–å½“å‰ Workspace æ–‡ä»¶æ ‘ï¼ˆéœ€ç¼“å­˜ï¼‰ã€‚
        - `/`: æœ¬åœ°ç¡¬ç¼–ç æŒ‡ä»¤é›† (`/clear`, `/reset`, `/drop`).
- **åç«¯æ”¯æŒ (Go)**:
    - æ¥å£: ä¼˜åŒ– `fs.ls` æ€§èƒ½ï¼Œæ”¯æŒé€’å½’æ·±åº¦æ§åˆ¶ï¼ˆé¿å…å¤§åº“å¡é¡¿ï¼‰ã€‚

#### 2.2 Feature B: ç´§æ€¥åœæ­¢ (Emergency Stop)
- **API è®¾è®¡**:
    - `POST /api/v2/process/stop`: å¼ºåˆ¶ç»ˆæ­¢å½“å‰è¿è¡Œçš„ Agent è¿›ç¨‹ã€‚
    - **å®ç°**: è°ƒç”¨ `ProcessManager.Stop()`ï¼Œæ— éœ€å¤æ‚çš„ RPC è½¬å‘ï¼ˆä¸åŒäº Happy çš„ Relay æ¨¡å¼ï¼Œæˆ‘ä»¬æ˜¯ Direct Serverï¼‰ã€‚
- **UI äº¤äº’**:
    - åœ¨ Chat åº•éƒ¨å‘é€æ å³ä¾§ï¼Œå½“ `AgentState == Running` æ—¶ï¼Œæ˜¾ç¤ºçº¢è‰²åœæ­¢å›¾æ ‡ã€‚

### 3. Phase 7: Future Voice (Design Preview)

- **æ ¸å¿ƒæ¨¡å¼**: Voice-to-Action (å‚è€ƒ Happy)ã€‚
- **æŠ€æœ¯æ ˆ**: 
    - å‰ç«¯: `@elevenlabs/react-native` (ç”¨äº STT/TTS + é€»è¾‘)ã€‚
    - å·¥å…·é“¾: å®šä¹‰ `clientTools` (å¦‚ `editCode`, `sendMessage`) ä¾›è¯­éŸ³æ¨¡å‹ç›´æ¥è°ƒç”¨ã€‚

## âœ… éªŒè¯è®¡åˆ’ (Verification)

### è‡ªåŠ¨åŒ–æµ‹è¯•
- **Build Test**: `go build ./...` å¿…é¡»æ— æŠ¥é”™ã€‚
- **Unit Test**: `manager_test.go` (éœ€è¡¥å……) æµ‹è¯• Start/Stop é€»è¾‘ã€‚

### æ‰‹åŠ¨éªŒè¯
- **ç¼–è¯‘éªŒè¯**: æ‰§è¡Œ `go run cmd/server/main.go` æˆåŠŸå¯åŠ¨ã€‚
- **UI äº¤äº’**: æ¨¡æ‹Ÿ App ç«¯å‘é€ `@`ï¼Œè§‚å¯Ÿæ—¥å¿—æ˜¯å¦è§¦å‘æ–‡ä»¶æ£€ç´¢è¯·æ±‚ã€‚
